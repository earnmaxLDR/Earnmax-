<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnMax Admin - Control Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Hind Siliguri', sans-serif; background: #f8fafc; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .sidebar-btn.active { background: #2563eb; color: white; border-radius: 15px; }
        .table-wrapper { overflow-x: auto; -webkit-overflow-scrolling: touch; }
    </style>
</head>
<body class="min-h-screen">

    <!-- ================= ADMIN LOGIN ================= -->
    <div id="admin-login-box" class="fixed inset-0 z-[100] bg-slate-900 flex items-center justify-center p-4">
        <div class="max-w-md w-full bg-white p-8 rounded-[40px] shadow-2xl text-center border-t-8 border-blue-600">
            <div class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-inner">
                <i class="fas fa-lock text-2xl"></i>
            </div>
            <h2 class="text-2xl font-black text-slate-800 mb-4 italic leading-none">মাস্টার লগইন</h2>
            <input type="password" id="adminPassInput" placeholder="সিক্রেট পাসওয়ার্ড" class="w-full bg-slate-50 border-2 border-transparent focus:border-blue-500 p-4 rounded-2xl text-center font-bold mb-4 outline-none">
            <button onclick="validateAdmin()" class="w-full bg-blue-600 text-white font-black py-4 rounded-2xl shadow-lg active:scale-95 transition-all uppercase italic">অ্যাক্সেস করুন</button>
        </div>
    </div>

    <!-- ================= MAIN LAYOUT ================= -->
    <div id="admin-main-content" class="hidden">
        <div class="flex flex-col md:flex-row min-h-screen">
            
            <!-- Sidebar -->
            <aside class="w-full md:w-64 bg-white border-r p-6 space-y-8">
                <div class="text-2xl font-black text-blue-600 italic tracking-tighter">EARN<span class="text-orange-500">MAX</span></div>
                <nav class="space-y-2">
                    <button onclick="showTab('dashboard', this)" class="sidebar-btn active w-full flex items-center gap-3 p-4 text-gray-500 font-bold italic transition-all">
                        <i class="fas fa-home"></i> হোম
                    </button>
                    <button onclick="showTab('activation', this)" class="sidebar-btn w-full flex items-center gap-3 p-4 text-gray-500 font-bold italic transition-all">
                        <i class="fas fa-user-check"></i> এক্টিভেশন <span id="act-count" class="bg-blue-100 text-blue-600 px-2 py-0.5 rounded text-[10px] ml-auto font-black">0</span>
                    </button>
                    <button onclick="showTab('withdrawals', this)" class="sidebar-btn w-full flex items-center gap-3 p-4 text-gray-500 font-bold italic transition-all">
                        <i class="fas fa-wallet"></i> উইথড্র <span id="wd-count" class="bg-emerald-100 text-emerald-600 px-2 py-0.5 rounded text-[10px] ml-auto font-black">0</span>
                    </button>
                    <button onclick="adminLogout()" class="w-full flex items-center gap-3 p-4 text-red-500 font-bold mt-10 hover:bg-red-50 rounded-2xl italic transition-all">
                        <i class="fas fa-sign-out-alt"></i> লগ আউট
                    </button>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="flex-1 p-4 md:p-10 space-y-8">
                
                <!-- Dashboard -->
                <div id="dashboard" class="tab-content active space-y-6">
                    <h2 class="text-2xl font-black text-slate-800 italic">সারসংক্ষেপ</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-[30px] border shadow-sm flex items-center gap-4">
                            <div class="w-12 h-12 bg-blue-50 text-blue-500 rounded-2xl flex items-center justify-center text-xl"><i class="fas fa-users"></i></div>
                            <div><p class="text-[10px] font-bold text-gray-400 uppercase italic">মোট ইউজার</p><h3 id="total-users" class="text-2xl font-black italic text-slate-800">০</h3></div>
                        </div>
                        <div class="bg-white p-6 rounded-[30px] border shadow-sm flex items-center gap-4">
                            <div class="w-12 h-12 bg-orange-50 text-orange-500 rounded-2xl flex items-center justify-center text-xl"><i class="fas fa-clock"></i></div>
                            <div><p class="text-[10px] font-bold text-gray-400 uppercase italic">পেন্ডিং একটিভ</p><h3 id="dash-act-count" class="text-2xl font-black italic text-orange-500">০</h3></div>
                        </div>
                        <div class="bg-white p-6 rounded-[30px] border shadow-sm flex items-center gap-4">
                            <div class="w-12 h-12 bg-emerald-50 text-emerald-500 rounded-2xl flex items-center justify-center text-xl"><i class="fas fa-money-check-alt"></i></div>
                            <div><p class="text-[10px] font-bold text-gray-400 uppercase italic">পেন্ডিং উইথড্র</p><h3 id="dash-wd-count" class="text-2xl font-black italic text-emerald-500">০</h3></div>
                        </div>
                    </div>
                </div>

                <!-- Activation Tab -->
                <div id="activation" class="tab-content space-y-6">
                    <h2 class="text-2xl font-black text-slate-800 italic uppercase">অ্যাকাউন্ট এক্টিভেশন</h2>
                    <div class="bg-white rounded-[35px] border shadow-sm table-wrapper overflow-hidden">
                        <table class="w-full text-left min-w-[500px]">
                            <thead class="bg-gray-50 text-[10px] uppercase text-gray-400 font-black italic">
                                <tr><th class="p-5">ইউজার নম্বর</th><th class="p-5">TrxID</th><th class="p-5 text-right">সিদ্ধান্ত</th></tr>
                            </thead>
                            <tbody id="activation-list" class="divide-y divide-gray-50 italic font-bold text-sm text-slate-700">
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Withdrawal Tab -->
                <div id="withdrawals" class="tab-content space-y-6">
                    <h2 class="text-2xl font-black text-slate-800 italic uppercase leading-none text-emerald-600">উইথড্র রিকোয়েস্ট</h2>
                    <div class="bg-white rounded-[35px] border shadow-sm table-wrapper overflow-hidden">
                        <table class="w-full text-left min-w-[600px]">
                            <thead class="bg-gray-50 text-[10px] uppercase text-gray-400 font-black italic">
                                <tr><th class="p-5">ইউজার</th><th class="p-5">টাকা</th><th class="p-5">মেথড ও নম্বর</th><th class="p-5 text-right">সিদ্ধান্ত</th></tr>
                            </thead>
                            <tbody id="wd-list" class="divide-y divide-gray-50 italic font-bold text-sm text-slate-700">
                            </tbody>
                        </table>
                    </div>
                </div>

            </main>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // আপনার Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyCDmgGZwwH4Vq4mAqp7IiGNJS7hXp15Bhk",
            authDomain: "earn-max-325e4.firebaseapp.com",
            databaseURL: "https://earn-max-325e4-default-rtdb.firebaseio.com",
            projectId: "earn-max-325e4",
            storageBucket: "earn-max-325e4.firebasestorage.app",
            messagingSenderId: "712165893771",
            appId: "1:712165893771:web:2e0b1459c4840a5167168e"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function validateAdmin() {
            if(document.getElementById('adminPassInput').value === "boss") {
                document.getElementById('admin-login-box').classList.add('hidden');
                document.getElementById('admin-main-content').classList.remove('hidden');
                localStorage.setItem('admin_session', 'active');
                loadAllData();
            } else { alert("ভুল পাসওয়ার্ড!"); }
        }

        function loadAllData() {
            // ১. এক্টিভেশন ডাটা
            database.ref('requests').on('value', (snapshot) => {
                const data = snapshot.val();
                const list = document.getElementById('activation-list');
                const badge = document.getElementById('act-count');
                const dashAct = document.getElementById('dash-act-count');
                const totalText = document.getElementById('total-users');
                list.innerHTML = "";
                let count = 0; let total = 0;
                if (data) {
                    for (let phone in data) {
                        total++;
                        if (data[phone].status === 'pending') {
                            count++;
                            list.innerHTML += `
                                <tr class="hover:bg-gray-50 transition">
                                    <td class="p-5">${phone}</td>
                                    <td class="p-5 text-blue-600 font-mono">${data[phone].trxId}</td>
                                    <td class="p-5 text-right flex justify-end gap-2">
                                        <button onclick="approveUser('${phone}')" class="bg-emerald-500 text-white px-4 py-2 rounded-xl text-[10px] font-black italic shadow-md active:scale-95 transition">APPROVE</button>
                                        <button onclick="rejectRequest('requests/${phone}')" class="bg-rose-50 text-rose-500 px-4 py-2 rounded-xl text-[10px] font-black italic active:scale-95 transition">REJECT</button>
                                    </td>
                                </tr>`;
                        }
                    }
                }
                badge.innerText = count; dashAct.innerText = count; totalText.innerText = total;
            });

            // ২. উইথড্র ডাটা
            database.ref('withdrawals').on('value', (snapshot) => {
                const data = snapshot.val();
                const list = document.getElementById('wd-list');
                const badge = document.getElementById('wd-count');
                const dashWd = document.getElementById('dash-wd-count');
                list.innerHTML = "";
                let count = 0;
                if (data) {
                    for (let id in data) {
                        if (data[id].status === 'pending') {
                            count++;
                            list.innerHTML += `
                                <tr class="hover:bg-gray-50 transition">
                                    <td class="p-5 text-slate-800">${data[id].phone}</td>
                                    <td class="p-5 text-emerald-600 font-black italic">৳ ${data[id].amount}</td>
                                    <td class="p-5 text-[11px] text-gray-500 font-bold italic leading-none">${data[id].method}<br><span class="text-blue-500 text-sm font-mono tracking-tighter">${data[id].number || data[id].wdNumber}</span></td>
                                    <td class="p-5 text-right flex justify-end gap-2">
                                        <button onclick="paidWithdraw('${id}')" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-[10px] font-black italic shadow-md active:scale-95 transition">PAID</button>
                                        <button onclick="rejectRequest('withdrawals/${id}')" class="bg-rose-50 text-rose-500 px-4 py-2 rounded-xl text-[10px] font-black italic active:scale-95 transition">REJECT</button>
                                    </td>
                                </tr>`;
                        }
                    }
                }
                badge.innerText = count; dashWd.innerText = count;
            });
        }

        // বাটন ফাংশন
        function approveUser(phone) { if(confirm("অ্যাকাউন্টটি APPROVE করবেন?")) { database.ref('requests/' + phone).update({ status: 'active' }); } }
        function paidWithdraw(id) { if(confirm("ইউজারকে কি টাকা পাঠিয়েছেন? PAID হিসেবে মার্ক করবেন?")) { database.ref('withdrawals/' + id).update({ status: 'paid' }); } }
        function rejectRequest(path) { if(confirm("রিকোয়েস্টটি কি REJECT করতে চান? এটি ডিলিট হয়ে যাবে।")) { database.ref(path).remove().then(() => alert("সাফল্যের সাথে রিজেক্ট করা হয়েছে।")); } }

        function showTab(id, btn) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            btn.classList.add('active');
        }

        function adminLogout() { localStorage.removeItem('admin_session'); location.reload(); }

        window.onload = function() {
            if(localStorage.getItem('admin_session') === 'active') {
                document.getElementById('admin-login-box').classList.add('hidden');
                document.getElementById('admin-main-content').classList.remove('hidden');
                loadAllData();
            }
        }
    </script>
</body>
</html>
